function CustomMapType(){}CustomMapType.prototype.tileSize=new google.maps.Size(256,256);CustomMapType.prototype.maxZoom=7;CustomMapType.prototype.getTile=function(b,a,c){var c=c.createElement("DIV"),f=templateDir+"/images/tiles/",f=f+(a+"_"+b.x+"_"+b.y+".png");c.style.width=this.tileSize.width+"px";c.style.height=this.tileSize.height+"px";c.style.backgroundColor="#00000";c.style.backgroundImage="url("+f+")";return c};CustomMapType.prototype.name="Custom";CustomMapType.prototype.alt="Tile Coordinate Map Type";
var map,CustomMapType=new CustomMapType,fullscreen=!1,showMobs=!1,showBanks=!1,showCrafts=!1,showBinds=!1,showPortals=!1,showChests=!1,showHoldings=!1,showVillages=!1,mobs=[],banks=[],binds=[],crafts=[],portals=[],chambers=[],chests=[],holdings=[],villages=[],searchArray=[],searchResults=[],infowindow=null;
function map_initialize(){var b={minZoom:3,maxZoom:7,isPng:!0,mapTypeControl:!1,streetViewControl:!1,center:new google.maps.LatLng(73,-109),zoom:4,mapTypeControlOptions:{mapTypeIds:["custom",google.maps.MapTypeId.ROADMAP],style:google.maps.MapTypeControlStyle.DROPDOWN_MENU}};map=new google.maps.Map(document.getElementById("map_canvas"),b);map.mapTypes.set("custom",CustomMapType);map.setMapTypeId("custom");google.maps.event.addListener(map,"click",function(a){placeMarker(a.latLng)});infowindow=new google.maps.InfoWindow({content:"loading..."});
getPOIs()}var marker,poiArray;function getUserLoc(b){b=b.split("%7C");b=new google.maps.LatLng(b[0],b[1]);placeMarker(b);map&&(map.setZoom(7),map.setCenter(b))}
function placeMarker(b){marker?(marker.setPosition(b),marker.title="Click Me!"):(marker=new google.maps.Marker({position:b,map:map,icon:templateDir+"/images/poi-default.png",title:"Click Me!"}),google.maps.event.addListener(marker,"click",function(){copyToClipboard(this)}));window.location.hash=marker.getPosition().lat()+"%7C"+marker.getPosition().lng()}
function copyToClipboard(b){window.prompt("Copy to clipboard: Ctrl+C, Enter","http://darkfallunholywars.info/world-map/#"+b.getPosition().lat()+"%7C"+b.getPosition().lng())}function getPOIs(){mobs.length||(jQuery.ajax({url:templateDir+"/getPOIs.php",dataType:"json",success:function(b){poiArray=b.pois;createMarkers()},error:function(){alert("Problem with Map. Please contact us through the feedback form describing what happened! Thanks!")}}),""!=userPOI&&getUserLoc(userPOI))}
function searchPOIs(b){if(3>b.length)alert("Please enter atleast 3 characters to perform search.");else{for(var a=0;a<searchResults.length;a++)searchResults[a].setMap(null);searchArray=[];for(a=0;a<poiArray.length;a++)null!=poiArray[a].title&&null!=poiArray[a].title.toLowerCase().match(b.toLowerCase())&&searchArray.push(poiArray[a]);showSearchResults(searchArray)}}
function showSearchResults(b){searchResults=[];if(0==b.length)alert("No Results Found. :(");else{for(var a=0;a<b.length;a++){for(var c=b[a]._poi_loc.split("|"),c=new google.maps.LatLng(c[0],c[1]),f=b[a].title,f=f.split(" | "),e='<ul class="poi-info">',d=0;d<f.length;d++)e=e+"<li>"+f[d]+"</li>";e=e+'</ul><a href="http://www.darkfallunholywars.info/wp-admin/post.php?post='+b[d].pid+'&action=edit" class="icon icon-cog" target="_blank" title="Edit POI">Edit POI</a>';c=new google.maps.Marker({position:c,
map:map,animation:google.maps.Animation.DROP,icon:templateDir+"/images/poi-pink.png",html:e});google.maps.event.addListener(c,"click",function(){copyToClipboard(this)});google.maps.event.addListener(c,"mouseover",function(){infowindow.setContent(this.html);infowindow.open(map,this)});searchResults.push(c)}b=new google.maps.LatLngBounds;for(a=0;a<searchResults.length;a++)searchResults[a].setMap(map),b.extend(searchResults[a].getPosition()),map.fitBounds(b)}}
function createMarkers(){for(var b=null,a,c=0;c<poiArray.length;c++){switch(poiArray[c]._poi_type){case "bank":a=templateDir+"/images/poi-bank.png";b=banks;break;case "mob":a=""==poiArray[c]._poi_level?templateDir+"/images/poi-mob.png":templateDir+"/images/poi-mob-"+poiArray[c]._poi_level+".png";b=mobs;break;case "city":a=templateDir+"/images/poi-city.png";b=holdings;break;case "hamlet":a=templateDir+"/images/poi-hamlet.png";b=holdings;break;case "cbind":a=templateDir+"/images/poi-bind-chaos.png";
b=binds;break;case "sbind":a=templateDir+"/images/poi-bind-safe.png";b=binds;break;case "craft":a=templateDir+"/images/poi-craft.png";b=crafts;break;case "portal":a=templateDir+"/images/poi-portal.png";b=portals;break;case "pchamber":a=templateDir+"/images/poi-chamber.png";b=portals;break;case "village":a=templateDir+"/images/poi-village.png";b=villages;break;case "chest":a=templateDir+"/images/poi-chest.png",b=chests}var f=poiArray[c]._poi_loc.split("|"),e=poiArray[c].title;null!=e&&e.match("|")&&
(e=e.split("|"));var d='<ul class="poi-info">';if(null!=e&&0<e.length)for(var g=0;g<e.length;g++)d=d+"<li>"+e[g]+"</li>";else d=d+"<li>"+e+"</li>";d=d+'</ul><a href="http://www.darkfallunholywars.info/wp-admin/post.php?post='+poiArray[c].pid+'&action=edit" class="icon icon-cog" target="_blank" title="Edit POI">Edit POI</a>';f=new google.maps.LatLng(f[0],f[1]);d=new google.maps.Marker({position:f,map:null,icon:a,html:d});google.maps.event.addListener(d,"click",function(){copyToClipboard(this)});google.maps.event.addListener(d,
"mouseover",function(){infowindow.setContent(this.html);infowindow.open(map,this)});b.push(d)}}function showMarkers(b){var a;switch(b){case "mobs":a=mobs;break;case "banks":a=banks;break;case "crafts":a=crafts;break;case "binds":a=binds;break;case "portals":a=portals;break;case "holdings":a=holdings;break;case "villages":a=villages;break;case "chests":a=chests}for(var b=new google.maps.LatLngBounds,c=0;c<a.length;c++)a[c].setMap(map),b.extend(a[c].getPosition()),map.fitBounds(b)}
function hideMarkers(b){var a;switch(b){case "mobs":a=mobs;break;case "banks":a=banks;break;case "crafts":a=crafts;break;case "binds":a=binds;break;case "portals":a=portals;break;case "holdings":a=holdings;break;case "villages":a=villages;break;case "chests":a=chests}for(b=0;b<a.length;b++)a[b].setMap(null)}
function checkToggles(){jQuery.each(jQuery("#map-legend a"),function(){if(jQuery(this).hasClass("active"))switch(jQuery(this).attr("id")){case "mob-btn":showMarkers("mobs");break;case "bank-btn":showMarkers("banks");break;case "craft-btn":showMarkers("crafts");break;case "bind-btn":showMarkers("binds");break;case "portal-btn":showMarkers("portals");break;case "holding-btn":showMarkers("holdings");break;case "village-btn":showMarkers("villages");break;case "chest-btn":showMarkers("chests")}})};
