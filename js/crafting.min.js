(function(b){window.crafter={skill:"",advanced:!1,mastery:!1,masteryList:[],allItems:[],firstDrop:[],secDrop:[],filteredList:[],item:{},itemCount:1,style:"militant",getData:function(a){crafter.reset();crafter.skill=b("#trade_select").val();switch(a){case "weaponsmithing":crafter.advanced=!0;break;default:crafter.advanced=!1}b.ajax({url:templateDir+"/data/crafting_recipes_"+a+".json",dataType:"json"}).success(function(a){crafter.allItems=a;if(crafter.mastery)for(a=0;a<crafter.allItems.length;a++)crafter.allItems[a].Skill.match("Mastery")&&
crafter.masteryList.push(crafter.allItems[a])},function(){crafter.createList(crafter.firstDrop,crafter.allItems)}).error(function(a,b,e){alert("Error Loading Items: "+arguments)})},createList:function(a,c){for(var c=crafter.mastery?crafter.masteryList:c,d=0;d<c.length;d++)if(crafter.advanced){var e=c[d].Name.split(" "),e=e[e.length-1];-1===b.inArray(e,a)&&a.push(e)}else-1===b.inArray(c[d].Name,a)&&a.push(c[d].Name);a.sort();crafter.appendList(a,b("#select-two"))},appendList:function(a,b){for(var d=
"",e=0;e<a.length;e++)d=d+'<option value="'+a[e].toLowerCase()+'">'+a[e]+"</option>";b.html(d);b.parent().fadeIn().find("input").focus()},reset:function(){crafter.skill="";crafter.advanced=!1;crafter.masteryList=[];crafter.allItems=[];crafter.firstDrop=[];crafter.secDrop=[];crafter.filteredList=[];b("#select-three").parent().hide();b("#item-details .template").fadeOut("",function(){b(this).remove()})},filterList:function(){crafter.filteredList=[];crafter.secDrop=[];for(var a=!crafter.mastery?crafter.allItems:
crafter.masteryList,c=RegExp("\\b"+b("#select-two").val(),"gi"),d=0;d<a.length;d++){if(a[d].Name.match(c)){var e=a[d].Name.split(" ")[0];-1===b.inArray(e,crafter.secDrop)&&crafter.secDrop.push(e);crafter.filteredList.push(a[d])}crafter.secDrop.sort();crafter.appendList(crafter.secDrop,b("#select-three"))}},showItem:function(a){crafter.item=a;var c=b("#item-template").clone().attr("id",a.id.replace(/ /g,"-"));c.find("#thumb").append('<img src="'+templateDir+"/data/icons/"+a.Icon+'" width="64" height="64"/>');
var d='<h3><span class="theName">'+a.Name+"</span></h3><p>",d=d+("<strong>Skill:</strong> "+a.Skill+"<br>"),d=d+("<strong>Min Level:</strong> "+a["Min Level"]+"<br>"),d=d+("<strong>Max Level:</strong> "+a["Max Level"]+"<br>"),d=d+("<strong>Quantity:</strong> "+a.Quantity+"<br>"),d=d+'<ul class="ingredients">',e;for(e in a.Recipe)d+="<li><strong>"+e+":</strong> "+a.Recipe[e]+"</li>";d+="</ul>";e='<ul class="extras">';for(var f in a.Additional)"object"!=typeof a.Additional[f]&&(e=e+"<li><strong>"+f+
":</strong> "+a.Additional[f]+"</li>");e+="</ul></p>";c.find(".ingredients .details").html(d+e);c.find(".recipe .well").html(crafter.calculate(a));c.find("#item-count").val(crafter.itemCount);b("#item-details").removeClass().addClass(a.Skill.toLowerCase()).html(c);c.fadeIn();a.Additional&&a.Additional.Extra&&crafter.popoverSetup(a.Additional.Extra);crafter.changeStyle()},popoverSetup:function(a){var c='<ul id="protections">',d;for(d in a)c+="<li><strong>"+d+":</strong> "+a[d]+"</li>";b("#item-details div.ingredients").attr("data-content",
c+"</ul>").popover()},calculate:function(a){var c=a.Name,d="checked"==b("#discount").attr("checked"),e=b("#item-count").val(),a="<strong>"+a.Quantity*crafter.itemCount+'</strong> <span class="theName"> '+c+"</span>: ",f;for(f in crafter.item.Recipe)a=d&&"Gold"==f?a+(Math.ceil(e*crafter.item.Recipe[f]-0.1*e*crafter.item.Recipe[f])+" "+f):a+(e*crafter.item.Recipe[f]+" "+f),Object.keys(crafter.item.Recipe)[Object.keys(crafter.item.Recipe).length-1]!=f&&(a+=", ");return a},changeStyle:function(){for(var a=
b(".theName:first").text().split(" "),c=0;c<a.length;c++)if("militant"==a[c].toLowerCase()||"stoic"==a[c].toLowerCase()||"barbaric"==a[c].toLowerCase())a[c]=crafter.style;a=a.join(" ");b(".theName").text(a);a=b("#item-details").find("#thumb img").attr("src");a=a.replace("militant",crafter.style).replace("barbaric",crafter.style).replace("stoic",crafter.style);b("#item-details").find("#thumb img").attr("src",a);b("#item-details .btn-group .btn").removeClass("active");b('#item-details .btn[data-style="'+
crafter.style+'"]').addClass("active")}};b("#trade_select").change(function(){crafter.getData(b(this).val())});b("#select-two").change(function(){if(crafter.advanced)crafter.filterList(b(this).find("option:selected").val());else for(var a=RegExp("\\b"+b("#select-two").val(),"gi"),c=0;c<crafter.allItems.length;c++)crafter.allItems[c].Name.match(a)&&crafter.showItem(crafter.allItems[c])});b("#select-three").change(function(){var a=RegExp(b("#select-three").val()+"\\s(.*)\\s?\\b"+b("#select-two").val(),
"gi");b("#select-three").val()===b("#select-two").val()&&(a=RegExp("^"+b("#select-three").val()+"$","i"));for(var c=0;c<crafter.filteredList.length;c++)crafter.filteredList[c].Name.match(a)&&crafter.showItem(crafter.filteredList[c])});b("#mastery").change(function(){crafter.mastery="checked"==b(this).attr("checked")?!0:!1;""!=b("#trade_select").val()&&crafter.getData(b("#trade_select").val())});b("#discount").change(function(){isEmpty(crafter.item)||b("#item-details .recipe .well").html(crafter.calculate(crafter.item))});
b("#item-count").live("change",function(){crafter.itemCount=b(this).val();b("#item-details .recipe .well").html(crafter.calculate(crafter.item));crafter.changeStyle()});b(".btn.styleSwitch").live("click",function(){crafter.style=b(this).data("style");crafter.changeStyle()});b(".recipe .well").live("click",function(){b("#recipeModal #recipeModalLabel").text(crafter.itemCount+" "+crafter.item.Name);b("#recipeModal #modalRecipeDetails").text(b(this).text());b("#recipeModal").modal("show")});b("#recipeModal").on("shown",
function(){b("#recipeModal #modalRecipeDetails").select()})})(jQuery);Array.prototype.inArray=function(b){for(var a=0;a<this.length;a++)if(b(this[a]))return!0;return!1};Array.prototype.pushIfNotExist=function(b,a){this.inArray(a)||this.push(b)};function isEmpty(b){return 0===Object.keys(b).length}
(function(b){b.widget("custom.combobox",{_create:function(){this.wrapper=b("<span>").addClass("custom-combobox").insertAfter(this.element);this.element.hide();this._createAutocomplete();this._createShowAllButton()},_createAutocomplete:function(){var a=this.element.children(":selected"),a=a.val()?a.text():"";this.input=b("<input>").appendTo(this.wrapper).val(a).attr("title","").addClass("custom-combobox-input ui-widget ui-widget-content ui-state-default ui-corner-left").autocomplete({delay:0,minLength:0,
source:b.proxy(this,"_source")}).tooltip({tooltipClass:"ui-state-highlight"});this._on(this.input,{autocompleteselect:function(a,b){b.item.option.selected=!0;this._trigger("select",a,{item:b.item.option})},autocompletechange:"_removeIfInvalid"})},_createShowAllButton:function(){var a=this.input,c=!1;b("<div>").attr("tabIndex",-1).attr("title","Show All Items").appendTo(this.wrapper).button({icons:{primary:"ui-icon-triangle-1-s"},text:!1}).removeClass("ui-corner-all").addClass("custom-combobox-toggle ui-corner-right").mousedown(function(){c=
a.autocomplete("widget").is(":visible")}).click(function(){a.focus();c||a.autocomplete("search","")})},_source:function(a,c){var d=RegExp(b.ui.autocomplete.escapeRegex(a.term),"i");c(this.element.children("option").map(function(){var c=b(this).text();if(this.value&&(!a.term||d.test(c)))return{label:c,value:c,option:this}}))},_removeIfInvalid:function(a,c){if(!c.item){var d=this.input.val(),e=d.toLowerCase(),f=!1;this.element.children("option").each(function(){if(b(this).text().toLowerCase()===e)return this.selected=
f=!0,!1});f||(this.input.val("").attr("title",d+" didn't match any item").tooltip("open"),this.element.val(""),this._delay(function(){this.input.tooltip("close").attr("title","")},2500),this.input.autocomplete("instance").term="")}},_destroy:function(){this.wrapper.remove();this.element.show()}})})(jQuery);
(function(b){b("#trade_select").combobox({select:function(){crafter.getData(this.value);b(".selection-box:first").find("input").val("").focus()}});b("#select-two").combobox({select:function(){if(crafter.advanced)crafter.filterList(this.value);else for(var a=RegExp("^\\b"+RegExp.escape(this.value),"gi"),c=0;c<crafter.allItems.length;c++)crafter.allItems[c].Name.match(a)&&crafter.showItem(crafter.allItems[c]);b(".selection-box:last").find("input").val("").focus()}});b("#select-three").combobox({select:function(){var a=
RegExp(this.value+"\\s(.*)\\s?\\b"+b("#select-two").val(),"gi");this.value===b("#select-two").val()&&(a=RegExp("^"+this.value+"$","i"));for(var c=0;c<crafter.filteredList.length;c++)crafter.filteredList[c].Name.match(a)&&crafter.showItem(crafter.filteredList[c])}})})(jQuery);RegExp.escape=function(b){return b.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")};
